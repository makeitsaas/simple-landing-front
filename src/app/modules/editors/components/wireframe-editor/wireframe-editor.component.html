<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

<div class="wireframe-editor">

  <!-- Background grid -->
  <div class="bg-grid">
    <div class="container">
      <div class="content">&nbsp;</div>
    </div>
  </div>

  <!-- Available new elements -->
  <div>

    <ng-container *ngTemplateOutlet="storeItems; context:{ $implicit: store }"></ng-container>

  </div>

  <!-- Actual page tree -->
  <div [dndDropzone]="['section']"
       (dndDrop)="onDrop($event, nestableList)">

    <ng-container *ngTemplateOutlet="recursiveList; context:{ parentType: 'page', list: nestableList }"></ng-container>

  </div>

  <!-- page bottom: add section - later (maybe put this action inside section) -->

  <pre>{{nestableList|json}}</pre>
</div>


<ng-template #storeItems let-store>
  <div *ngFor="let storeItem of store">
    <div [dndDraggable]="storeItem"
         [dndType]="storeItem.type"
         dndEffectAllowed="copy"
         [dndDisableIf]="storeItem.disable"
         (dndStart)="onDragStart($event)"
         (dndCopied)="onDragged(storeItem, store, 'copy')"
         (dndLinked)="onDragged(storeItem, store, 'link')"
         (dndMoved)="onDragged(storeItem, store, 'move')"
         (dndCanceled)="onDragged(storeItem, store, 'none')"
         (dndEnd)="onDragEnd($event)">
      {{storeItem.content}}
    </div>
  </div>
</ng-template>

<ng-template #recursiveList
             let-parentType="parentType"
             let-list="list">

  <mat-card dndPlaceholderRef
            class="dndPlaceholder"
            [ngClass]="getCommonChildCssClasses(parentType)"
  >
  </mat-card>

  <div *ngFor="let item of list"
       [dndDraggable]="item"
       [dndType]="item.type"
       dndEffectAllowed="move"
       [dndDisableIf]="item.disable"
       (dndStart)="onDragStart($event)"
       (dndCopied)="onDragged(item, list, 'copy')"
       (dndLinked)="onDragged(item, list, 'link')"
       (dndMoved)="onDragged(item, list, 'move')"
       (dndCanceled)="onDragged(item, list, 'none')"
       (dndEnd)="onDragEnd($event)"
       [ngClass]="getElementCssClasses(item, parentType)">

    <mat-icon *ngIf="item.handle"
              mat-list-icon
              dndHandle>drag_handle
    </mat-icon>

    <div *ngIf="item.type === 'block'" class="block">
      <div class="block-icon">
        Block {{ item.type }}
        <span class="glyphicon glyphicon-text-size"></span>
      </div>
    </div>

    <div *ngIf="item.customDragImage"
         dndDragImageRef>MY_CUSTOM_DRAG_IMAGE
    </div>

    <div *ngIf="item.children && item.type !== 'block'"
         class="nested-children-container"
         [class.row]="item.type === 'columns'"
         [dndDropzone]="getAcceptableChildrenTypes(item)"
         (dndDrop)="onDrop($event, item.children)">

      <ng-container *ngTemplateOutlet="recursiveList; context:{ parentType: item.type, list: item.children }"></ng-container>

    </div>

  </div>

</ng-template>

